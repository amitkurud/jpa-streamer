<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Stream Examples :: JPA Streamer Docs</title>
    <meta name="generator" content="Antora 2.3.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">JPA Streamer Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jpa-streamer" data-version="0.1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../introduction/overview.html">JPAStreamer Docs</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/overview.html">Overview</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/installation.html">Installing JPAStreamer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/quick-start.html">Quick Start with JPAStreamer</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Stream Fundamentals</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="what_is_a_stream.html">What is a Stream?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="intermediate_operations.html">Intermediate Operations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="terminal_operations.html">Terminal Operations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="other_operations.html">Other Operations</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Fetching Data</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fetching-data/sql-equivalents.html">SQL Equivalents</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fetching-data/stream-examples.html">Stream Examples</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">JPAStreamer Docs</span>
    <span class="version">0.1.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">JPAStreamer Docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../introduction/overview.html">0.1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../introduction/overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../introduction/overview.html">JPAStreamer Docs</a></li>
    <li><a href="stream-examples.html">Stream Examples</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Stream Examples</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section contains mixed examples of how streams can operate on entities of type <code>User</code>. The <code>User</code> class looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">static class User {

        private static final List&lt;String&gt; CARS = Arrays.asList("Toyota", "Volvo", "Tesla", "Fiat", "Ford");

        private final int id;

        public User(int id) {
            this.id = id;
        }

        public int getId() {
            return id;
        }

        public String getName() {
            return "Name" + id;
        }

        public String getPassword() {
            return "PW" + (id ^ 0x7F93A27F);
        }

        public String getFavoriteCar() {
            return CARS.get(id % CARS.size());
        }

        public int getBornYear() {
            return 1950 + id % 50;
        }

        @Override
        public String toString() {
            return String.format(
                "{id=%d, name=%s, password=%s, favoriteCar=%s, bornYear=%d}",
                getId(),
                getName(),
                getPassword(),
                getFavoriteCar(),
                getBornYear()
            );
        }

        @Override
        public boolean equals(Object obj) {
            if (!(obj instanceof User)) {
                return false;
            }
            User that = (User) obj;
            return this.id == that.id;
        }

        @Override
        public int hashCode() {
            return id;
        }

    }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the examples all fields will be derived from the <code>id</code>. This is good for tests and examples but of course not so useful in real applications. Because the id defines all other fields, only the id field needs to be used in the <code>equals</code> and <code>hashCode</code> methods.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The first users will thus be:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">User</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{id=0, name=Name0, password=PW346289151, favoriteCar=Toyota, bornYear=1950}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{id=1, name=Name1, password=PW1420030975, favoriteCar=Volvo, bornYear=1951}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{id=2, name=Name2, password=PW883160063, favoriteCar=Tesla, bornYear=1952}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{id=3, name=Name3, password=PW1956901887, favoriteCar=Fiat, bornYear=1953}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{id=4, name=Name4, password=PW77853695, favoriteCar=Ford, bornYear=1954}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{id=5, name=Name5, password=PW1151595519, favoriteCar=Toyota, bornYear=1955}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There is also a <code>UserManager</code> that provides a static stream method that will return a <code>Stream&lt;User&gt;</code> that contains 1000 elements (with user ids in the range 0 to 999). The <code>UserManager</code> class is shown hereunder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    static class UserManager {
        static Stream&lt;User&gt; stream() {
            return IntStream.range(0, 1000)
                .mapToObj(User::new);
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how the stream method creates an <code>IntStream</code> with elements from 0 to 999 and then maps each <code>int</code> element to a <code>User</code> object using the <code>User</code> constructor that takes an <code>int</code> as an argument.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_count_the_number_of_ford_likers"><a class="anchor" href="#_count_the_number_of_ford_likers"></a>Count the Number of Ford Likers</h3>
<div class="paragraph">
<p>The example below counts the number of users that like Ford:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    long count = UserManager.stream()
        .filter(u -&gt; "Ford".equals(u.getFavoriteCar()))
        .count();

        System.out.format("There are %d users that supports Ford %n", count);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above will produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">There are 200 users that supports Ford</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_calculate_average_age"><a class="anchor" href="#_calculate_average_age"></a>Calculate Average Age</h3>
<div class="paragraph">
<p>The following example calculates the average age of the users that like Tesla assuming the current year is 2017:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    OptionalDouble avg = UserManager.stream()
        .filter(u -&gt; "Tesla".equals(u.getFavoriteCar()))
        .mapToInt(u -&gt; 2017 - u.getBornYear()) // Calculates the age
        .average();

    if (avg.isPresent()) {
        System.out.format("The average age of Tesla likers are %d years %n", avg.getAsDouble());
    } else {
        System.out.format("There are no Tesla lovers");
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above will produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">The average age of Tesla likers are 42.500000 years</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_find_the_youngest_volvo_digger"><a class="anchor" href="#_find_the_youngest_volvo_digger"></a>Find the Youngest Volvo Digger</h3>
<div class="paragraph">
<p>The next example sets out to locate the youngest Volvo digger. The solution imposed below sorts all users in bornYear order and then picks the first one. Is there another solution without sort?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Comparator&lt;User&gt; comparator = Comparator.comparing(User::getBornYear).reversed();

    Optional&lt;User&gt; youngest = UserManager.stream()
        .filter(u -&gt; "Volvo".equals(u.getFavoriteCar()))
        .sorted(comparator)
        .findFirst();

    youngest.ifPresent(u
        -&gt; System.out.println("Found the youngest Volvo digger which is :" + u.toString())
    );</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will produce the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Found the youngest Volvo digger which is :{id=46, name=Name46, password=PW782496767, favoriteCar=Volvo, bornYear=1996}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_collect_a_stream_in_a_list"><a class="anchor" href="#_collect_a_stream_in_a_list"></a>Collect a Stream in a List</h3>
<div class="paragraph">
<p>The following example collects all users that love Fiat in a List:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        List&lt;User&gt; fiatLovers = UserManager.stream()
            .filter(u -&gt; "Fiat".equals(u.getFavoriteCar()))
            .collect(Collectors.toList());

        System.out.format("There are %d fiat lovers %n", fiatLovers.size());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above will produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">There are 200 fiat lovers</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_element_flow"><a class="anchor" href="#_element_flow"></a>Element Flow</h3>
<div class="paragraph">
<p>The example below examines the flow of elements and the different operations in the stream&#8217;s pipeline. A <code>Stream</code> with five names is created and a <code>filter</code> is used to find those having a name that starts with the letter "A".
A <code>sort</code> operation is also applied to the remaining names and then lastly the names are mapped to lower case. Lastly the remaining elements are printed. Print statements are used in between operations to enable observation of the separate operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    Stream.of("Bert", "Alice", "Charlie", "Assian", "Adam")
        .filter(s -&gt; {
            String required = "A";
            boolean result = s.startsWith(required);
            System.out.format("filter        : \"%s\".startsWith(\"%s\") is %s (%s) %n", s, required, result, result ? "retained" : "dropped");
            return result;
        })
        .sorted((s1, s2) -&gt; {
            int result = s1.compareTo(s2);
            System.out.format("sort          : compare(%s, %s) is %d (%s)%n", s1, s2, result, result &lt; 0 ? "not swapped" : "swapped");
            return result;
        })
        .map(s -&gt; {
            String result = s.toLowerCase();
            System.out.format("map           : %s -&gt; %s %n", s, result);
            return result;
        })
        .forEachOrdered(s
            -&gt; System.out.println("forEachOrdered: " + s)
        );</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will print:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">filter        : "Bert".startsWith("A") is false (dropped)
filter        : "Alice".startsWith("A") is true (retained)
filter        : "Charlie".startsWith("A") is false (dropped)
filter        : "Assian".startsWith("A") is true (retained)
filter        : "Adam".startsWith("A") is true (retained)
sort          : compare(Assian, Alice) is 7 (swapped)
sort          : compare(Adam, Assian) is -15 (not swapped)
sort          : compare(Adam, Assian) is -15 (not swapped)
sort          : compare(Adam, Alice) is -8 (not swapped)
map           : Adam -&gt; adam
forEachOrdered: adam
map           : Alice -&gt; alice
forEachOrdered: alice
map           : Assian -&gt; assian
forEachOrdered: assian</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, in the end, the stream delivered the elements "adam", "alice" and "assian" as expected. Note how <code>sort</code> needs to retrieve all the element via the <code>filter</code> stage before it can emit result to the next stage. On the contrary, the last steps are executed in pipeline order because both <code>map</code> and <code>forEachOrdered</code> can process a stream element one at a time.</p>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
